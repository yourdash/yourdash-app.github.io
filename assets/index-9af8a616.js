import{u as v,r as d,j as e,c as m,e as x,s as I,I as _,Y as i,H as r,b as g,f as H,h as b,T as U,S as z,m as f,n as B,O,R as T,a as p}from"./index-5bcd9038.js";import{p as E}from"./index-ca444653.js";import{N as D}from"./NavBar-6e345f09.js";const y=({to:s})=>{const o=v();return d.useEffect(()=>{o(s)},[s]),e.jsxs(e.Fragment,{children:["Redirecting to ",s]})},F="_component_i5y5x_6",J="_content_i5y5x_18",M="_label_i5y5x_27",G="_header_i5y5x_33",R={component:F,content:J,label:M,header:G},$=320;function u(s){return s.width/s.height}function L(s,o,t,a){const n=s.map(c=>u(c.dimensions)).reduce((c,h)=>c+h);let l=Math.min(o/n,$);return s.length===1&&s[0].dimensions.width>o&&(l=Math.min(o/u(s[0].dimensions),$)),a&&(l=Math.min(t+20,l)),l}function Y(s,o){return s.map(t=>o*u(t.dimensions)).reduce((t,a)=>t+a)}function A(s,o,t){const a=[];let n=0,l=0;for(;l<s.length;){const c=[];do c.push(s[l++]);while(l<s.length&&Y([...c,s[l]],t)<=o);const h=L(c,o,t,s.length===l);a[n]={items:c.map(S=>({...S,displayWidth:h*u(S.dimensions),displayHeight:h})),height:h},n+=1}return a}const q="_component_eqtrk_6",V="_photo_eqtrk_25",C={component:q,photo:V},X=({path:s,dimensions:o,tags:t,imageUrl:a,display:n})=>{const l=v();return e.jsx("div",{onClick:()=>{l("/app/a/photos/photo/"+s)},className:C.component,style:{width:n.width!==0?`${n.rowHeight*u(o)}px`:"100%",height:`${n.rowHeight}px`},children:e.jsx("img",{alt:"",className:C.photo,src:m.getInstanceUrl()+a})})},K="_row_qw29n_6",Q={row:K},W=({items:s,height:o})=>e.jsx("div",{className:Q.row,style:{height:o+"px"},children:s.map(t=>e.jsx(X,{path:t.path,dimensions:t.dimensions,tags:t.tags,imageUrl:t.imageUrl||"",display:{rowHeight:o,height:t.displayHeight,width:t.displayWidth,aspectRatio:u(t.dimensions)}},t.imageUrl))}),Z="_component_1j762_6",ee="_content_1j762_17",se="_label_1j762_26",te="_header_1j762_32",oe={component:Z,content:ee,label:se,header:te};let w=[];const k=({gridPhotoPaths:s})=>{const o=x.useRef(null),[t,a]=d.useState([]);return d.useEffect(()=>{let n;const l=new ResizeObserver(()=>{clearTimeout(n),n=setTimeout(()=>{var c;a(A(w,((c=o.current)==null?void 0:c.getBoundingClientRect().width)||512,256))},100)});return l.observe(o.current,{box:"border-box"}),()=>{l.disconnect()}},[]),d.useEffect(()=>{Promise.all(s.map(n=>new Promise((l,c)=>{m.getJson(`/app/photos/grid-photo/${n}`,h=>{h?l(h):c()},h=>{console.log(h)})}))).then(n=>{var l;w=n,a(A(w,((l=o.current)==null?void 0:l.getBoundingClientRect().width)||512,256))})},[s]),e.jsx("div",{className:oe.content,ref:o,children:t.map(n=>e.jsx(W,{items:n.items,height:n.height},n.items[0].imageUrl))})},ne=()=>{const s=I()["*"],o=v(),[t,a]=x.useState(null);return d.useEffect(()=>{m.getJson(`/app/photos/album/${s}`,n=>{a({label:E.basename(n.path),items:n.items,path:n.path})},n=>{console.log(n)})},[s]),t===null?null:e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("div",{className:"flex flex-row items-center p-12 pl-4 pr-4",children:[e.jsx(_,{icon:i.ChevronLeft,onClick:()=>{o("..")}}),e.jsx(r,{level:1,className:"pl-4",children:t.label}),e.jsxs("div",{className:"ml-auto gap-2 flex",children:[t.items.photos.length>0&&e.jsxs(r,{level:4,children:["Photos: ",t.items.photos.length]}),t.items.subAlbums.length>0&&e.jsxs(r,{level:4,children:["Sub Albums: ",t.items.subAlbums.length]}),t.items.videos.length>0&&e.jsxs(r,{level:4,children:["Videos: ",t.items.videos.length]})]})]}),e.jsx("div",{className:R.component,children:e.jsxs("div",{className:R.content,children:[e.jsx("div",{className:"flex w-full gap-2",children:t.items.subAlbums.map(n=>e.jsx("a",{href:"#/app/a/photos/album/"+n.path,className:"flex flex-grow",children:e.jsx(g,{onClick:()=>0,className:"flex flex-grow items-center text-center justify-center",children:e.jsx(r,{level:4,children:n.displayName})})},n.path))}),e.jsx(k,{gridPhotoPaths:t.items.photos})]})})]})},le="_separator_b7dgn_6",ae="_horizontal_b7dgn_10",ce="_vertical_b7dgn_16",N={separator:le,horizontal:ae,vertical:ce},re=({direction:s})=>e.jsx("div",{className:H(N.separator,s==="horizontal"?N.horizontal:N.vertical)}),ie="_component_1j762_6",he="_content_1j762_17",pe="_label_1j762_26",de="_header_1j762_32",j={component:ie,content:he,label:pe,header:de},me=({path:s})=>{const[o,t]=x.useState(!1),[a,n]=x.useState(null);return d.useEffect(()=>{m.getJson(`/app/photos/album/${s}`,l=>{n({label:E.basename(l.path),items:l.items,path:l.path})},l=>{console.log(l)})},[]),a===null?null:e.jsxs("div",{className:j.component,children:[e.jsxs("div",{className:H(j.header,o&&j.open),children:[o?e.jsx(_,{onClick:()=>{t(!1)},icon:i.FoldUp}):e.jsx(_,{onClick:()=>{t(!0)},icon:i.FoldDown}),e.jsx(r,{level:3,className:j.label,children:a.label}),e.jsxs("div",{className:"pl-2 gap-2 flex",children:[a.items.photos.length>0&&e.jsxs("div",{children:["Photos: ",a.items.photos.length]}),a.items.subAlbums.length>0&&e.jsxs("div",{children:["Sub Albums: ",a.items.subAlbums.length]}),a.items.videos.length>0&&e.jsxs("div",{children:["Videos: ",a.items.videos.length]})]})]}),o&&e.jsxs("div",{className:j.content,children:[e.jsx("div",{className:"flex w-full gap-2 flex-wrap",children:a.items.subAlbums.map(l=>e.jsx("a",{href:"#/app/a/photos/album/"+l.path,className:"flex flex-grow",children:e.jsx(g,{onClick:()=>0,className:"flex flex-grow items-center text-center justify-center",children:e.jsx(r,{level:4,children:l.displayName})})},l.path))}),e.jsx(k,{gridPhotoPaths:a.items.photos})]})]})},xe=()=>{const[s,o]=d.useState([]);return d.useEffect(()=>{o([]),m.getJson("/app/photos/albums",t=>{o(t)},t=>{console.log(t)})},[]),e.jsxs("div",{className:"flex flex-col h-full p-4 gap-2",children:[e.jsx(r,{level:1,children:"Home"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(g,{className:"gap-2 flex flex-col",children:[e.jsx(b,{icon:i.Search,className:"h-8"}),e.jsx(r,{level:3,children:"Search"})]}),e.jsxs(g,{className:"gap-2 flex flex-col",children:[e.jsx(b,{icon:i.Search,className:"h-8"}),e.jsx(r,{level:3,children:"Search"})]}),e.jsxs(g,{className:"gap-2 flex flex-col",children:[e.jsx(b,{icon:i.Search,className:"h-8"}),e.jsx(r,{level:3,children:"Search"})]})]}),e.jsx(re,{direction:"horizontal"}),s.length===0&&e.jsx(e.Fragment,{children:e.jsx("div",{className:"text-3xl",children:"No photos yet"})}),s.map(t=>e.jsx(me,{path:t},t))]})},ue="_photoContainer_5cjza_6",je="_photo_5cjza_6",ge="_page_5cjza_19",fe="_header_5cjza_26",P={photoContainer:ue,photo:je,page:ge,header:fe},_e="/assets/icon-8a6cc0f9.avif",ve=()=>{const s=I()["*"],[o,t]=x.useState();return x.useEffect(()=>{m.getJson("/app/photos/photo/"+s,a=>{t(a)},()=>{window.history.back()})},[s]),o?e.jsxs("div",{className:P.page,children:[e.jsx(D,{showBackButton:!0,title:"Photos",subtitle:"Preview",iconUrl:_e,extras:e.jsx(e.Fragment,{children:e.jsx(_,{icon:i.Download,onClick:()=>{window.open(m.getInstanceUrl()+"/app/photos/download-photo/"+s,"_blank")}})})}),e.jsx("div",{className:P.photoContainer,children:e.jsx("img",{className:P.photo,src:m.getInstanceUrl()+o.imageUrl,alt:""})})]}):null},be=()=>e.jsxs("div",{children:[e.jsx(r,{level:1,children:"Search Photos"}),e.jsx(U,{accessibleName:"Search Photos",onChange:s=>0,icon:i.Search,placeholder:"Search Photos"})]}),we=()=>{const s=v();return e.jsxs("div",{className:"h-full grid w-full grid-cols-[auto,1fr]",children:[e.jsx(z,{title:"Select files",items:[{label:"Home",onClick(){s("/app/a/photos/")},type:f.Button,icon:i.Home},{label:"Search",onClick(){return s("/app/a/photos/search"),0},type:f.Button,icon:i.Search},{type:f.Separator,id:"sep1"},{label:"Upload",onClick(){return s("/app/a/photos/upload"),0},type:f.Button,icon:i.Upload}],defaultState:B.NormalExpanded}),e.jsx("div",{className:"flex flex-col w-full h-full overflow-y-auto bg-bg",children:e.jsx(O,{})})]})},ye=()=>e.jsx(T,{children:e.jsxs(p,{element:e.jsx(we,{}),children:[e.jsx(p,{index:!0,element:e.jsx(xe,{})}),e.jsx(p,{path:"search",element:e.jsx(be,{})}),e.jsxs(p,{path:"album",children:[e.jsx(p,{index:!0,element:e.jsx(y,{to:"/app/a/photos"})}),e.jsx(p,{path:"*",element:e.jsx(ne,{})})]}),e.jsxs(p,{path:"photo",children:[e.jsx(p,{index:!0,element:e.jsx(y,{to:"/app/a/photos"})}),e.jsx(p,{path:"*",element:e.jsx(ve,{})})]})]})});export{ye as default};
