import{u as T,s as ne,j as e,O as oe,B as O,i as g,g as d,e as X,r as o,f as y,b as j,d as H,q as B,n as q,W as K,X as z,H as Q,h as Z,T as ce,R as re,a as N}from"./index-ad359391.js";import{B as D}from"./buttonWithIcon-3a101dd6.js";import{P as ie}from"./progressBar-63376cc4.js";const le="_navigation_1vis6_10",ue="_applicationFrame_1vis6_22",de="_applicationView_1vis6_30",U={navigation:le,applicationFrame:ue,applicationView:de},me={id:"uk-ewsgit-photos",displayName:"Photos",description:"This is the default application description, you can edit this information in this application's 'application.json'",category:"core",license:"MIT",maintainers:[{name:"Ewsgit",avatarUrl:"https://avatars.githubusercontent.com/u/69800526?v=4",bio:"The creator of YourDash",url:"https://ewsgit.uk"}],authors:[{name:"Ewsgit",avatarUrl:"https://avatars.githubusercontent.com/u/69800526?v=4",bio:"The creator of YourDash",url:"https://ewsgit.uk"}],modules:{backend:[{dependencies:[],description:"The backend for the Photos application",id:"uk-ewsgit-photos-backend",main:"./backend/index.ts"}],frontend:[],officialFrontend:[{id:"uk-ewsgit-photos-frontend",main:"./web/index.tsx",displayName:"Photos",iconPath:"./icon.avif",description:"",dependencies:[{moduleType:"backend",id:"uk-ewsgit-photos-backend"}]}]},shouldInstanceRestartOnInstall:!0,__internal__generatedFor:"officialFrontend"},ee=new ne("/app/uk-ewsgit-photos-backend"),te=()=>{const t=T();return a=>t("/app/a/uk-ewsgit-photos-frontend"+a)},he=()=>{const t=te();return e.jsx(e.Fragment,{children:e.jsxs("div",{className:U.applicationFrame,children:[e.jsx("div",{className:U.applicationView,children:e.jsx(oe,{})}),e.jsxs(O,{className:U.navigation,children:[e.jsx(g,{accessibleLabel:"Home",icon:d.Home,onClick:()=>{t("/")}}),e.jsx(g,{accessibleLabel:"Search",icon:d.Search,onClick:()=>{t("/search/")}}),e.jsx(g,{accessibleLabel:"Profile",icon:d.Person,onClick:()=>{t("/profile/")}})]})]})})},pe="_component_fi888_6",ge="_items_fi888_15",be="_endOfItems_fi888_19",A={component:pe,items:ge,endOfItems:be},se=({children:t,fetchNextPage:a,containerClassName:n,className:s,hasMorePages:m,resetState:u,dontShowNoMoreItems:h})=>{const l=X.useRef(null),[r,i]=o.useState(!0),p=X.useRef(-1);o.useEffect(()=>{p.current=-1,i(!0)},[u]);const b=async()=>{m&&(p.current++,i(!0),await a(p.current),i(!1))};return o.useEffect(()=>{if(!l.current)return;b();const R=l.current;new IntersectionObserver(c=>{c[0].isIntersecting&&b()}).observe(R)},[]),e.jsxs("div",{className:y(n,A.component),children:[e.jsx("div",{className:y(s,A.items),children:t}),r&&e.jsx("div",{children:"Loading more content"}),!m&&e.jsx("div",{children:"No More Pages Exist"}),e.jsx("div",{ref:l,className:A.endOfItems,children:!h&&"No more items to load"})]})},xe=()=>e.jsx(e.Fragment,{children:"Album Media"}),_e="_component_3bjn0_10",je="_album_3bjn0_18",fe="_thumbnailContainer_3bjn0_26",ve="_thumbnail_3bjn0_26",we={component:_e,album:je,thumbnailContainer:fe,thumbnail:ve},E=({path:t,scrollerClassName:a})=>{T();const[n,s]=o.useState([]),[m,u]=o.useState(!0);return o.useEffect(()=>{u(!0),s([])},[t]),e.jsx(se,{hasMorePages:m,resetState:t,fetchNextPage:async h=>{const l=await ee.getJson(`/album/media/${h}/@`+t);s(r=>[...r,...l])},className:y(we.component,a),children:n.map(h=>e.jsx(xe,{}))})},Ne="_component_3bjn0_10",Pe="_album_3bjn0_18",ye="_thumbnailContainer_3bjn0_26",Le="_thumbnail_3bjn0_26",C={component:Ne,album:Pe,thumbnailContainer:ye,thumbnail:Le},Y=({path:t,scrollerClassName:a})=>{const n=j.getCurrentModuleId(me),s=T(),[m,u]=o.useState([]),[h,l]=o.useState(!0);return o.useEffect(()=>{l(!0),u([])},[t]),m?e.jsx(se,{hasMorePages:h,resetState:t,fetchNextPage:async r=>{const i=await ee.getJson(`/album/sub/${r}/@`+t);(i==null?void 0:i.length)===0&&l(!1),u(p=>[...p,...i])},className:y(C.component,a),children:m.map(r=>e.jsxs(H,{containerClassName:C.album,onClick:()=>{s(`/app/a/${n}/album/?p=`+j.path.toUnix(r.path))},children:[e.jsx(B,{containerClassName:C.thumbnailContainer,className:C.thumbnail,accessibleLabel:"",authenticatedImage:!0,src:r.thumbnail}),e.jsx(q,{text:r.displayName})]},r.path))}):null},Ce="_header_17zt7_10",Se="_heading_17zt7_18",$e="_page_17zt7_22",ke="_contentView_17zt7_27",Ie="_subAlbums_17zt7_34",Te="_mediaGrid_17zt7_38",P={header:Ce,heading:Se,page:$e,contentView:ke,subAlbums:Ie,mediaGrid:Te},Re=()=>{const t=te(),[a]=K(),n=a.get("p")||"";return e.jsxs("div",{className:P.page,children:[e.jsxs("div",{className:P.header,children:[e.jsx(g,{accessibleLabel:"Go back",icon:d.ChevronLeft,onClick:()=>{const s=z.join(n,"..");if(s==="/"&&n==="/"){t("/");return}t(`/album/?p=${s}`)}}),e.jsx(Q,{className:P.heading,level:1,text:z.basename(n)||n})]}),e.jsx(Y,{scrollerClassName:P.subAlbums,path:n||"/"}),e.jsx(E,{scrollerClassName:P.mediaGrid,path:n||"/"})]})},Fe=""+new URL("photosLogo-7e4e3549.png",import.meta.url).href,Ve="_header_fc37t_10",Me="_brandName_fc37t_20",Ue="_brandLogo_fc37t_24",Ae="_page_fc37t_30",S={header:Ve,brandName:Me,brandLogo:Ue,page:Ae},Xe=()=>e.jsxs(e.Fragment,{children:[e.jsxs(O,{className:S.header,children:[e.jsx(B,{disableLazyLoading:!0,accessibleLabel:"Photos logo",src:Fe,className:S.brandLogo}),e.jsx(Q,{className:S.brandName,text:"Photos",level:3})]}),e.jsxs("div",{className:S.page,children:[e.jsx(Y,{path:"/photos"}),e.jsx(E,{path:"/photos"})]})]}),Be=({results:t})=>e.jsx(e.Fragment,{children:t.map(a=>e.jsx(e.Fragment,{children:a.fileName}))}),Ee="_page_68cfa_10",Ye="_searchBar_68cfa_18",Ge="_subAlbums_68cfa_29",$={page:Ee,searchBar:Ye,subAlbums:Ge},ze=()=>{const[t,a]=X.useState(""),n=Z(()=>j.getJson("/app/photos/media/search/"),[t]);return e.jsxs("div",{className:$.page,children:[e.jsx(ce,{className:$.searchBar,accessibleName:"Search Media",onChange:s=>{a(s)},placeholder:"Search Media...",icon:d.Search}),n&&e.jsx(Be,{results:n}),e.jsx(Y,{scrollerClassName:$.subAlbums,path:"/photos"}),e.jsx(E,{scrollerClassName:$.subAlbums,path:"/photos"})]})},ae=({children:t,minZoom:a,maxZoom:n,onScaleChange:s})=>{const m=o.useRef(null),[u,h]=o.useState(0),[l,r]=o.useState(0),[i,p]=o.useState(1);s&&o.useEffect(()=>{s(i)},[i]);const b=c=>{c.stopPropagation();const x=c.deltaY,f=i+x/1e3;p(Math.min(Math.max(f,a??.1),n??10))},R=c=>{c.stopPropagation();const x=c.clientX,f=c.clientY,F=u,L=l,v=_=>{_.stopPropagation();const V=_.clientX-x,M=_.clientY-f;h(F+V),r(L+M)},w=()=>{c.stopPropagation(),document.removeEventListener("mousemove",v),document.removeEventListener("mouseup",w)};document.addEventListener("mousemove",v),document.addEventListener("mouseup",w)},G=c=>{c.stopPropagation();const x=c.touches,f=u,F=l,L=w=>{w.stopPropagation();const _=w.touches,V=_[0].clientX-x[0].clientX,M=_[0].clientY-x[0].clientY;h(f+V),r(F+M)},v=()=>{c.stopPropagation(),document.removeEventListener("touchmove",L),document.removeEventListener("touchend",v)};document.addEventListener("touchmove",L),document.addEventListener("touchend",v)};return e.jsx("div",{ref:m,style:{width:"100%",height:"100%",overflow:"hidden",display:"flex",alignItems:"center",justifyContent:"center"},onWheel:b,onMouseDown:R,onTouchStart:G,onDragStart:c=>{c.stopPropagation(),c.preventDefault()},onContextMenu:c=>{c.preventDefault(),c.stopPropagation()},children:e.jsx("div",{style:{transform:`translate(${u}px, ${l}px) scale(${i})`,transformOrigin:"center center",maxWidth:"max-content",pointerEvents:"none"},children:t})})},De="_viewVideo_reil1_10",We="_controls_reil1_18",W={viewVideo:De,controls:We},Je=({mediaUrl:t})=>{const a=o.useRef(null),[n,s]=o.useState(!1),[m,u]=o.useState(!1),[h,l]=o.useState(0),[r,i]=o.useState(0),[p,b]=o.useState(!1);return e.jsxs(e.Fragment,{children:[e.jsx(ae,{children:e.jsx("video",{onCanPlayThrough:()=>s(!0),onPlay:()=>{u(!0)},onPause:()=>{u(!1)},onDurationChange:()=>{l(a.current.duration)},onTimeUpdate:()=>{i(a.current.currentTime)},loop:p,ref:a,draggable:!1,autoPlay:!0,className:W.viewVideo,src:j.getInstanceUrl()+t})}),n&&e.jsx(e.Fragment,{children:h>0&&e.jsxs("div",{className:W.controls,children:[e.jsx(g,{accessibleLabel:"Rewind",icon:d.ArrowLeft,onClick:()=>{a.current.currentTime-=2}}),e.jsx(g,{accessibleLabel:"Play / Pause",icon:m?d.Stop:d.Play,onClick:()=>{m?a.current.pause():a.current.play()}}),e.jsx(g,{accessibleLabel:"Fast Forward",icon:d.ArrowRight,onClick:()=>{a.current.currentTime+=2}}),e.jsx(ie,{value:r/h}),e.jsx(g,{accessibleLabel:"Loop",icon:p?d.CrossReference:d.FeedMerged,onClick:()=>{b(!p)}})]})})]})},Oe="_page_1nb23_10",He="_video_1nb23_18",qe="_header_1nb23_22",Ke="_heading_1nb23_37",Qe="_spacer_1nb23_41",k={page:Oe,video:He,header:qe,heading:Ke,spacer:Qe},Ze="_viewImage_12s9m_6",et="_scale_12s9m_15",J={viewImage:Ze,scale:et},tt=({mediaUrl:t})=>{const[a,n]=o.useState(1);return e.jsx(e.Fragment,{children:e.jsxs(ae,{onScaleChange:s=>n(s),children:[e.jsx(B,{className:J.viewImage,src:t,authenticatedImage:!0,accessibleLabel:""}),e.jsx(H,{className:J.scale,children:e.jsx(q,{text:`${a*100}% scale`})})]})})};var I=(t=>(t[t.Image=0]="Image",t[t.Video=1]="Video",t[t.Unknown=2]="Unknown",t))(I||{});const st=()=>{const[t]=K(),a=t.get("p")||"",n=T(),s=Z(()=>j.getJson(`/app/photos/media/raw/@/${a}`),[a]);return e.jsxs("div",{className:y(k.page,(s==null?void 0:s.type)===I.Video&&k.video),children:[e.jsxs("div",{className:k.header,children:[e.jsx(D,{text:"Go Back",icon:d.ChevronLeft,onClick:()=>{n(-1)}}),e.jsx("div",{className:k.spacer}),e.jsx(D,{text:"Download",icon:d.Download,onClick:()=>{window.open(`${j.getInstanceUrl()}${s==null?void 0:s.mediaUrl}`,"_blank")}})]}),s&&e.jsxs(e.Fragment,{children:[s.type===I.Image&&e.jsx(tt,{mediaUrl:s.mediaUrl}),s.type===I.Video&&e.jsx(Je,{mediaUrl:s.mediaUrl})]})]})},ct=()=>e.jsx(re,{children:e.jsxs(N,{element:e.jsx(he,{}),children:[e.jsx(N,{index:!0,element:e.jsx(Xe,{})}),e.jsx(N,{path:"search",element:e.jsx(ze,{})}),e.jsx(N,{path:"album",element:e.jsx(Re,{})}),e.jsx(N,{path:"view",element:e.jsx(st,{})})]})});export{ct as default};
