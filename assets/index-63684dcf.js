import{u as v,j as e,O as ce,B as D,m as g,k as l,b as j,i as z,o as Z,t as B,f as ee,e as p,p as te,D as k,r as h,S as re,E as ie,G as ae,y as E,z as X,h as le,T as de,J as C,R as he,a as N}from"./index-35df064e.js";const me="_navigation_h5ky6_10",pe="_applicationFrame_h5ky6_22",ue="_application_h5ky6_22",A={navigation:me,applicationFrame:pe,application:ue},ge=()=>{const t=v();return e.jsx(e.Fragment,{children:e.jsxs("div",{className:A.applicationFrame,children:[e.jsx("div",{className:A.application,children:e.jsx(ce,{})}),e.jsxs(D,{className:A.navigation,children:[e.jsx(g,{accessibleLabel:"Home",icon:l.Home,onClick:()=>{t("/app/a/photos/")}}),e.jsx(g,{accessibleLabel:"Search",icon:l.Search,onClick:()=>{t("/app/a/photos/search/")}}),e.jsx(g,{accessibleLabel:"Profile",icon:l.Person,onClick:()=>{t("/app/a/photos/profile/")}})]})]})})},xe="_component_yhfky_10",_e="_icon_yhfky_50",H={component:xe,icon:_e},O=t=>j.jsxs("button",{className:z(H.component,t.className),onClick:t.onClick,"aria-label":t.text,disabled:t.disabled,children:[j.jsx(Z,{size:"1.25rem",className:H.icon,icon:t.icon}),t.text]});var m=(t=>(t[t.IMAGE=0]="IMAGE",t[t.VIDEO=1]="VIDEO",t[t.ALBUM=2]="ALBUM",t))(m||{});const je="_header_zza4a_6",ve="_heading_zza4a_17",be="_albumGrid_zza4a_21",ye="_pagination_zza4a_30",P={header:je,heading:ve,albumGrid:be,pagination:ye},Y=320;function I(t){return t.width/t.height}function fe(t,s,a,n){const r=t.map(c=>I({width:c.metadata.width,height:c.metadata.height})).reduce((c,d)=>c+d);let o=Math.min(s/r,Y);return t.length===1&&t[0].metadata.width>s&&(o=Math.min(s/I({width:t[0].metadata.width,height:t[0].metadata.height}),Y)),n&&(o=Math.min(a+20,o)),o}function we(t,s){return t.map(a=>s*I({width:a.metadata.width,height:a.metadata.height})).reduce((a,n)=>a+n)}function J(t,s,a){const n=[];let r=0,o=0;for(;o<t.length;){const c=[];do c.push(t[o++]);while(o<t.length&&we([...c,t[o]],a)<=s);const d=fe(c,s,a,t.length===o);n[r]={items:c.map(u=>({...u,displayWidth:d*I({width:u.metadata.width,height:u.metadata.height})})),height:d},r+=1}return n}const Ne="_component_1imm5_10",Le="_image_1imm5_29",Ie="_videoOverlay_1imm5_35",$e="_videoIcon_1imm5_44",Ce="_dimensionOverlay_1imm5_48",L={component:Ne,image:Le,videoOverlay:Ie,videoIcon:$e,dimensionOverlay:Ce},Pe=({data:t,aspectRatio:s,rowHeight:a,displayWidth:n})=>{const r=v();switch(t.type){case m.IMAGE:case m.VIDEO:return e.jsxs("div",{className:L.component,style:{width:n!==0?`${a*s}px`:"100%",height:`${a}px`},onClick:()=>{r("/app/a/photos/view/?p="+t.path)},children:[e.jsx(B,{className:L.image,accessibleLabel:"User Photo",src:t.mediaUrl,authenticatedImage:!0}),t.type===m.VIDEO&&e.jsx("div",{className:L.videoOverlay,children:e.jsx(Z,{icon:l.Video,className:L.videoIcon})}),t.type===m.IMAGE&&e.jsxs("div",{className:L.dimensionOverlay,onClick:o=>o.stopPropagation(),children:[t.metadata.width,"x",t.metadata.height]})]});default:return e.jsx(e.Fragment,{children:"MEDIA RENDERING ERROR"})}},Re="_component_1344w_10",Se={component:Re},ke=({rowHeight:t,items:s})=>e.jsx("div",{className:Se.component,style:{height:t+"px"},children:s.map(a=>e.jsx(Pe,{data:a,rowHeight:t,aspectRatio:I({height:a.metadata.height,width:a.metadata.width}),displayWidth:a.displayWidth},a.path))}),Oe="_album_o4098_6",Ee={album:Oe},Me=({album:t})=>{const s=v();return e.jsx(ee,{containerClassName:Ee.album,onClick:()=>{s("/app/a/photos/album/?p="+p.path.toUnix(t.path))},children:e.jsx(te,{text:k.basename(p.path.toUnix(t.path))})},t.path)},Te="_component_1cpqr_10",Fe="_albumContainer_1cpqr_24",W={component:Te,albumContainer:Fe},Ue=({items:t,albums:s})=>{const a=h.useRef(null),[n,r]=h.useState([]);return h.useEffect(()=>{if(!a.current)return;let o;const c=new ResizeObserver(()=>{clearTimeout(o),o=setTimeout(()=>{var d;r(J(t,((d=a.current)==null?void 0:d.getBoundingClientRect().width)||512,256))},100)});return c.observe(a.current,{box:"border-box"}),r(J(t,a.current.getBoundingClientRect().width||512,256)),()=>{c.disconnect()}},[t]),e.jsxs("div",{className:W.component,ref:a,children:[n.length===0&&s.length===0&&e.jsx(re,{}),s.length>0&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:W.albumContainer,children:s.map(o=>e.jsx(Me,{album:o},o.path))}),n.length>0&&e.jsx(ie,{direction:"column"})]}),n.map(o=>e.jsx(ke,{items:o.items,rowHeight:o.height},o.items[0].path))]})},Ge=()=>{const t=v(),[s]=ae(),a=s.get("p")||"",[n,r]=h.useState(0),o=E(()=>p.getJson(`/app::photos/media/album/large-grid/${n}/@/${a}`),[a,n])||[];return h.useEffect(()=>{console.log("reset page count as album path has changed"),r(0)},[a]),e.jsxs(e.Fragment,{children:[e.jsxs(D,{className:P.header,children:[e.jsx(g,{accessibleLabel:"Go back",icon:l.ChevronLeft,onClick:()=>{const c=k.join(a,"..");if(c==="/"&&a==="/"){t("/app/a/photos/");return}t(`/app/a/photos/album/?p=${c}`)}}),e.jsx(X,{className:P.heading,level:1,text:k.basename(a)||a})]}),e.jsx("div",{className:P.albumGrid,children:e.jsx(Ue,{items:o.filter(c=>c.type===m.IMAGE||c.type===m.VIDEO),albums:o.filter(c=>c.type===m.ALBUM)})}),e.jsx("div",{className:P.pagination,children:o.length>0&&e.jsxs(e.Fragment,{children:[n>0&&e.jsx(O,{text:"Previous page",icon:l.ChevronLeft,onClick:()=>{r(n-1)}}),(o.length===64||o.length===63)&&e.jsx(O,{text:"Next page",icon:l.ChevronRight,onClick:()=>{r(n+1)}})]})})]})},Ae=""+new URL("photosLogo-7e4e3549.png",import.meta.url).href,Ve="_header_fc37t_10",De="_brandName_fc37t_20",ze="_brandLogo_fc37t_24",Be="_page_fc37t_30",R={header:Ve,brandName:De,brandLogo:ze,page:Be},Xe="_component_kcjic_10",He="_heading_kcjic_19",Ye="_album_kcjic_23",V={component:Xe,heading:He,album:Ye},se=()=>{const t=v(),s=E(()=>p.getJson("/app::photos/album/@/photos"),[]);return s?e.jsxs(e.Fragment,{children:[e.jsx(X,{className:V.heading,level:2,text:"Albums"}),e.jsx("div",{className:V.component,children:s.map(a=>e.jsx(ee,{containerClassName:V.album,onClick:()=>{t("/app/a/photos/album/?p="+p.path.toUnix(a))},children:e.jsx(te,{text:k.basename(p.path.toUnix(a))})},a))})]}):null},Je=()=>e.jsxs(e.Fragment,{children:[e.jsxs(D,{className:R.header,children:[e.jsx(B,{disableSpinner:!0,disableLazyLoading:!0,accessibleLabel:"Photos logo",src:Ae,className:R.brandLogo}),e.jsx(X,{className:R.brandName,text:"Photos",level:3})]}),e.jsx("div",{className:R.page,children:e.jsx(se,{})})]}),We=({results:t})=>e.jsx(e.Fragment,{children:t.map(s=>e.jsx(e.Fragment,{children:s.fileName}))}),qe="_page_jxbzo_10",q={page:qe},Ke=()=>{const[t,s]=le.useState(""),a=E(()=>p.getJson("/app::photos/media/search/"),[t]);return e.jsxs("div",{className:q.page,children:[e.jsx(de,{className:q.searchBar,accessibleName:"Search Media",onChange:n=>{s(n)},placeholder:"Search Media...",icon:l.Search}),a&&e.jsx(We,{results:a}),e.jsx(se,{})]})},Qe="_component_svexo_10",Ze="_bar_svexo_22",K={component:Qe,bar:Ze},et=({value:t,className:s})=>j.jsx("div",{className:z(K.component,s),children:j.jsx("div",{className:K.bar,style:{"--ukcomp-progress":`${t*100}%`}})}),ne=({children:t,minZoom:s,maxZoom:a})=>{const n=C.useRef(null),[r,o]=C.useState(0),[c,d]=C.useState(0),[u,M]=C.useState(1),b=i=>{i.stopPropagation();const x=i.deltaY,y=u+x/1e3;M(Math.min(Math.max(y,s??.1),a??10))},T=i=>{i.stopPropagation();const x=i.clientX,y=i.clientY,F=r,$=c,f=_=>{_.stopPropagation();const U=_.clientX-x,G=_.clientY-y;o(F+U),d($+G)},w=()=>{i.stopPropagation(),document.removeEventListener("mousemove",f),document.removeEventListener("mouseup",w)};document.addEventListener("mousemove",f),document.addEventListener("mouseup",w)},oe=i=>{i.stopPropagation();const x=i.touches,y=r,F=c,$=w=>{w.stopPropagation();const _=w.touches,U=_[0].clientX-x[0].clientX,G=_[0].clientY-x[0].clientY;o(y+U),d(F+G)},f=()=>{i.stopPropagation(),document.removeEventListener("touchmove",$),document.removeEventListener("touchend",f)};document.addEventListener("touchmove",$),document.addEventListener("touchend",f)};return j.jsx("div",{ref:n,style:{width:"100%",height:"100%",overflow:"hidden",display:"flex",alignItems:"center",justifyContent:"center"},onWheel:b,onMouseDown:T,onTouchStart:oe,onDragStart:i=>{i.stopPropagation(),i.preventDefault()},onContextMenu:i=>{i.preventDefault(),i.stopPropagation()},children:j.jsx("div",{style:{transform:`translate(${r}px, ${c}px) scale(${u})`,transformOrigin:"center center",maxWidth:"max-content",pointerEvents:"none"},children:t})})},tt="_viewVideo_reil1_10",at="_controls_reil1_18",Q={viewVideo:tt,controls:at},st=({mediaUrl:t})=>{const s=h.useRef(null),[a,n]=h.useState(!1),[r,o]=h.useState(!1),[c,d]=h.useState(0),[u,M]=h.useState(0),[b,T]=h.useState(!1);return e.jsxs(e.Fragment,{children:[e.jsx(ne,{children:e.jsx("video",{onCanPlayThrough:()=>n(!0),onPlay:()=>{o(!0)},onPause:()=>{o(!1)},onDurationChange:()=>{d(s.current.duration)},onTimeUpdate:()=>{M(s.current.currentTime)},loop:b,ref:s,draggable:!1,autoPlay:!0,className:Q.viewVideo,src:p.getInstanceUrl()+t})}),a&&e.jsx(e.Fragment,{children:c>0&&e.jsxs("div",{className:Q.controls,children:[e.jsx(g,{accessibleLabel:"Rewind",icon:l.ArrowLeft,onClick:()=>{s.current.currentTime-=2}}),e.jsx(g,{accessibleLabel:"Play / Pause",icon:r?l.Stop:l.Play,onClick:()=>{r?s.current.pause():s.current.play()}}),e.jsx(g,{accessibleLabel:"Fast Forward",icon:l.ArrowRight,onClick:()=>{s.current.currentTime+=2}}),e.jsx(et,{value:u/c}),e.jsx(g,{accessibleLabel:"Loop",icon:b?l.CrossReference:l.FeedMerged,onClick:()=>{T(!b)}})]})})]})},nt="_page_38flg_10",ot="_video_38flg_17",ct="_header_38flg_21",rt="_heading_38flg_36",it="_spacer_38flg_40",S={page:nt,video:ot,header:ct,heading:rt,spacer:it},lt="_viewImage_bvumm_6",dt={viewImage:lt},ht=({mediaUrl:t})=>e.jsx(e.Fragment,{children:e.jsx(ne,{children:e.jsx(B,{className:dt.viewImage,src:t,authenticatedImage:!0,disableSpinner:!1,accessibleLabel:""})})}),mt=()=>{const[t]=ae(),s=t.get("p")||"",a=v(),n=E(()=>p.getJson(`/app::photos/media/raw/@/${s}`),[s]);return e.jsxs("div",{className:z(S.page,(n==null?void 0:n.type)===m.VIDEO&&S.video),children:[e.jsxs("div",{className:S.header,children:[e.jsx(O,{text:"Go Back",icon:l.ChevronLeft,onClick:()=>{a(-1)}}),e.jsx("div",{className:S.spacer}),e.jsx(O,{text:"Download",icon:l.Download,onClick:()=>{window.open(`${p.getInstanceUrl()}${n==null?void 0:n.mediaUrl}`,"_blank")}})]}),n&&e.jsxs(e.Fragment,{children:[n.type===m.IMAGE&&e.jsx(ht,{mediaUrl:n.mediaUrl}),n.type===m.VIDEO&&e.jsx(st,{mediaUrl:n.mediaUrl})]})]})},ut=()=>e.jsx(he,{children:e.jsxs(N,{element:e.jsx(ge,{}),children:[e.jsx(N,{index:!0,element:e.jsx(Je,{})}),e.jsx(N,{path:"search",element:e.jsx(Ke,{})}),e.jsx(N,{path:"album",element:e.jsx(Ge,{})}),e.jsx(N,{path:"view",element:e.jsx(mt,{})})]})});export{ut as default};
